define(["ajax","jquery","define","selector","scroll","contextmenu","content","lib/url"],function(n,i,t,a,o,e,s,l){return{file:{lang:null,login:null,path:null,init:function(n,i){this.lang=n,this.login=i,this.initFolderRoot(),this.loadPath()},initFolderRoot:function(){var n="<li>";n+='<p class="root">',n+='<span class="icomoon icon-folder"></span>',n+="<span>"+this.lang.get("default.loading")+"</span>",n+="</p>",n+="</li>",a.sidebarFileList.html(n),this.repaintListEntry()},setPath:function(n){this.path=n},getPath:function(){return this.path},loadPath:function(i,t){var o=n.script.index,e=this;"string"==typeof i&&(o+="?directory="+i),void 0!==t&&"p"===t.get(0).tagName.toLowerCase()||(t=a.sidebarFileList.find("> li > p.root"));var l=t.find("span.icomoon"),r=t.parent();if(l.hasClass("icon-folder-open"))return l.removeClass("icon-folder-open").addClass("icon-folder"),void r.find("> p + ul").css({display:"none"}).html("");n.open({url:o,begin:function(){e.startSpinner(r)},end:function(){e.stopSpinner(r),e.repaintListEntry(),e.bindClickListEntry()},success:function(n){if(e.login.check(n)){var i=r.find("> p + ul");i.length<=0&&(r.append("<ul></ul>"),i=r.find("> p + ul")),e.setPath(n.data.path),e.renderDataList(i,n.data.path,n.data.list),s.file.renderDataList(n.data.path,n.data.list)}}})},bindClickListEntry:function(){var n=this;a.sidebarFileList.find("p").each(function(){var i=$(this),t=i.parent();i.unbind("click").bind("click",function(){n.loadPath(l.rawDecode(t.attr("path")),i),console.log("Click: "+i),console.log(t)}).unbind("contextmenu").bind("contextmenu",function(n){e.show(i,{open:"Mở",copy:"Sao chép",move:"Di chuyển",delete:"Xóa",chmod:"Phân quyền",info:"Thông tin"},function(n,i){console.log(n),console.log(i)}),n.preventDefault()})})},startSpinner:function(n){n.find("> p > span.icomoon").removeClass("icon-folder").addClass("icon-spinner spinner-animation")},stopSpinner:function(n){n.find("> p > span.icomoon").removeClass("icon-spinner spinner-animation").addClass("icon-folder")},is:!1,renderDataList:function(n,i,t){n.stop().css({display:"block",opacity:1});var o=[],e=[],s="/",r="",d=a.sidebarFileList.find("> li");0===i.indexOf("/")?(o.push("/"),i=i.substr(1)):s="\\",e=i.split(s);for(g=0;g<e.length;++g)o.push(e[g]);for(g=0;g<o.length;++g){var p=o[g];if(r+=p,0===g)d.find("> p > span:last-child").html(p),d.find("> p > span.icomoon:first-child").removeClass("icon-folder").addClass("icon-folder-open"),"\\"===s&&(r+=s);else{var c=d.find('> ul > li[name="'+p+'"]');if(g+1<o.length&&(r+=s),void 0===c||c.length<=0){var f="<ul>";f+='<li name="'+p+'" is_directory="true">',f+="<p>",f+='<span class="icomoon icon-folder-open"></span>',f+="<span>"+p+"</span>",f+="</p>",f+="</li>",f+="</ul>",d.append(f),c=d.find('> ul > li[name="'+p+'"]')}(d=c).find("> p:first-child > span:last-child").html(p),d.find("> p:first-child > span.icomoon:first-child").removeClass("icon-folder").addClass("icon-folder-open"),d.attr("path",l.rawEncode(r))}}var h=d,u="",m=null;h.find("> p + ul").length<=0&&h.append("<ul></ul>"),h=h.find("> p + ul").html("");for(var g=0;g<t.length;++g)(m=t[g]).is_directory?u+='<li name="'+m.name+'" is_directory="true" path="'+l.rawEncode(m.path)+'">':u+='<li name="'+m.name+'" is_directory="false" path="'+l.rawEncode(m.path)+'">',u+="<p>",m.is_directory?u+='<span class="icomoon icon-folder"></span>':u+='<span class="icomoon '+m.icon+'"></span>',u+="<span>"+m.name+"</span>",u+="</p>",u+="</li>";h.append(u)},repaintListEntry:function(){a.sidebarFileList.find("li > p").each(function(){var n=$(this),i=n.parent().parent().parent(),t=0;if(void 0===n.attr("class")||-1===n.attr("class").indexOf("root")?t+=30:t+=10,void 0!==i&&"li"===i.get(0).tagName.toLowerCase()){var a=i.find("p:first-child").css("paddingLeft");t+=a=void 0===a?5:-1!==a.indexOf("px")?parseInt(a.substr(0,a.length-2)):10}n.css({paddingLeft:t+"px"})})}},database:{initDatabase:function(){}}}});